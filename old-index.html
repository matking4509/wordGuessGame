<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
    <meta charset="UTF-8">
    <title>All Glory to the Hypnotoad</title>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-12 border-bottom">
          <img src="assets/images/WordGuessTitle.png">
        </div>
      </div>
      <div class="row">
        <div id="instruct" class="col-12 text-center border">
          <p>The Hypnotoad has put a name in your head.</p>  
          <p>You will be given 10 attempts to press the correct letters to display the word.</p>
        </div>
      </div>
      <div class="row">
        <div id="hint-div" class="col-6 text-center border">
          <p><span id="hint">This is where the Hints go</span></p>
        </div>
        <div id="game-div" class="col-6 text-center border">
          <p><span id="word-mask">Waiting on Word...</span></p>
          <p> <span id="used-letters">You have typed no Letters</span></p>
          <p>You have <span id="guess-count">XX</span> guesses remaining</p>
        </div>
      </div>
    </div>
    <script type="text/javascript">
    
    var debugLogs = true;
    
    var htIntro = new Audio("assets/sound/allhailhynotoad.mp3");
    htIntro.play();
    
    // Word/Hint Dictionary
    var wordObj = {
      word : ["professor",
              "fry",
              "leela"],
      hint : ["Old Cranky Man",
              "Young Redheaded Uncle",
              "One-Eyed Brannigan Lover"],
      image : ["professor.png",
               "fry.png",
               "leela.png"],
      sound : ["farnsworth1.mp3",
               "fry.mp3",
               "leela.mp3"]
    };

    //Select Word for Game
    var wordSelector = Math.floor(Math.random()*wordObj["word"].length)
    var guessCnt = 10;
    var usedLettersAry = [];
    var wordMask = '';
    var typedLetter = "r";
    var gameOn = true;
        
    //print Hint 
    var hintDoc = document.getElementById("hint");
    hintDoc.textContent = wordObj["hint"][wordSelector];

    // Deine Game Div to Show Winner and Loser!
    var gameDivDoc = document.getElementById("game-div");
    var hintDivDoc = document.getElementById("hint-div");

    //print Initial WordMask
    wordObj["word"][wordSelector].split('').forEach(function(element) {
          var wordSearch = usedLettersAry.indexOf(element);
          if (wordSearch >= 0) {
            wordMask = wordMask + element + " ";
          } else {
            wordMask = wordMask + "_ ";
          }
    });
    var wordMaskDoc = document.getElementById("word-mask");
    wordMaskDoc.innerHTML = wordMask;
    console.log(wordMask);
    
    //print initial Number of guesses Remaining.
    var guessCntDoc = document.getElementById("guess-count");
    guessCntDoc.textContent = guessCnt;

    // Print used leters
    var usedLettersDoc = document.getElementById("used-letters");
    usedLettersDoc.textContent = "[ None ]"

  // ** KeyCapture EVENTS! Next!

    document.onkeyup = function(event) {
      var wordMask = '';
          guessCnt--;                
          // if (event.key.match(/^[a-z0-9]+$/i) && event.key.match(/^[a-z0-9]+$/i).length == 1 ) {
            usedLettersAry.push(event.key);
          // }
          console.log("usedletters on press: " + usedLettersAry);
          wordObj["word"][wordSelector].split('').forEach(function(element) {
            var wordSearch = usedLettersAry.indexOf(element);
            if (wordSearch >= 0) {
              wordMask = wordMask + element + " ";
            } else {
              wordMask = wordMask + "_ ";
            }
          });
          console.log(wordMask);
          var winCnt = (wordMask.match(/_/g)||[]).length;
          console.log("wordcount :" + wordObj["word"][wordSelector].length);
          console.log("winCnt: " + winCnt);
          wordMaskDoc.innerHTML = wordMask;
          guessCntDoc.textContent = guessCnt;
          usedLettersDoc.textContent = "[ " + usedLettersAry + " ]";
        if (guessCnt < 1 || winCnt < 1) {
          if (guessCnt < 1 || winCnt > 0) {
            gameDivDoc.innerHTML = "Game Over<br>You Lose!";
            hintDivDoc.innerHTML = "<img src=\"assets/images/hypnotoad.gif\">";
            var audio = new Audio("assets/sound/hpnotoadBuzz.mp3");
            audio.play();
            gameOn = false;
          } else {
            gameDivDoc.innerHTML = "You Win!"
            hintDivDoc.innerHTML = "<img src=\"assets/images/"+wordObj["image"][wordSelector]+"\">"
            var audio = new Audio("assets/sound/"+wordObj["sound"][wordSelector]);
            audio.play();
            gameOn = false;
          }
        }
    };
    
    

    
    
    //Variable debug Console Logs
    // console.log("wordSearch: " + wordSearch);
    if (debugLogs == true) {
      console.log(wordMask);
      console.log(wordObj);
      console.log("wordcount :" + wordObj["word"].length);
      console.log("hintcount :" + wordObj["hint"].length);
      console.log(wordSelector);
      console.log("Selected Word: " + wordObj["word"][wordSelector]);
      console.log(guessCnt);
      console.log(usedLettersAry);
    }

    // Filter Alphanumeric Only
    // After the user wins/loses the game should automatically choose another word and make the user play it.
    // Wins: (# of times user guessed the word correctly).
    // test loop / on-key array growth
    </script>
  </body>

</html>